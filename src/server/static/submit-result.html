<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Result â€” proof-at-home</title>
    <link rel="stylesheet" href="/shared.css">
</head>
<body>
    <nav id="navbar"></nav>
    <div class="container">
        <h1>Submit Proof Result</h1>
        <div id="msg" class="msg" style="display:none"></div>

        <form id="form" onsubmit="return submitForm(event)">
            <div class="form-group">
                <label for="problem_id">Problem ID</label>
                <input type="text" id="problem_id" required>
            </div>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" required>
            </div>
            <div class="form-group checkbox-group">
                <input type="checkbox" id="success">
                <label for="success">Proof successful</label>
            </div>
            <div class="form-group">
                <label for="proof_script">Proof Script</label>
                <textarea id="proof_script" rows="8"></textarea>
            </div>
            <div class="form-group">
                <label for="cost_usd">Cost (USD)</label>
                <input type="number" id="cost_usd" step="0.01" min="0" value="0">
            </div>
            <div class="form-group">
                <label for="attempts">Attempts</label>
                <input type="number" id="attempts" min="0" value="1">
            </div>
            <div class="form-group">
                <label for="error_output">Error Output</label>
                <textarea id="error_output" rows="4"></textarea>
            </div>
            <button type="submit">Submit Result</button>
        </form>
    </div>
    <script src="/shared.js"></script>
    <script>
        async function submitForm(e) {
            e.preventDefault();
            hideMsg('msg');
            const body = {
                problem_id: document.getElementById('problem_id').value.trim(),
                username: document.getElementById('username').value.trim(),
                success: document.getElementById('success').checked,
                proof_script: document.getElementById('proof_script').value,
                cost_usd: parseFloat(document.getElementById('cost_usd').value) || 0,
                attempts: parseInt(document.getElementById('attempts').value) || 0,
                error_output: document.getElementById('error_output').value
            };
            try {
                await api('POST', '/results', body);
                showMsg('msg', 'Result submitted successfully.', false);
            } catch (e) {
                showMsg('msg', 'Error: ' + (e.error || e.message || 'submission failed'), true);
            }
            return false;
        }
    </script>
</body>
</html>
