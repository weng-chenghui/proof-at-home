<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Problem â€” proof-at-home</title>
    <link rel="stylesheet" href="/shared.css">
</head>
<body>
    <nav id="navbar"></nav>
    <div class="container">
        <h1>Submit Problem Package</h1>
        <div id="msg" class="msg" style="display:none"></div>

        <div class="tab-bar">
            <button class="active" onclick="switchTab('upload')">Upload tar.gz</button>
            <button onclick="switchTab('git')">Git URL</button>
        </div>

        <div id="tab-upload" class="tab-panel active">
            <div class="form-group">
                <label for="file">Problem package (.tar.gz)</label>
                <input type="file" id="file" accept=".tar.gz,.tgz">
            </div>
            <button onclick="submitFile()">Upload</button>
        </div>

        <div id="tab-git" class="tab-panel">
            <div class="form-group">
                <label for="gitUrl">Git repository URL</label>
                <input type="text" id="gitUrl" placeholder="https://github.com/user/problems.git">
            </div>
            <button onclick="submitGit()">Submit</button>
        </div>
    </div>
    <script src="/shared.js"></script>
    <script>
        function switchTab(name) {
            document.querySelectorAll('.tab-bar button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('tab-' + name).classList.add('active');
            event.target.classList.add('active');
            hideMsg('msg');
        }

        async function submitFile() {
            const input = document.getElementById('file');
            if (!input.files.length) {
                showMsg('msg', 'Please select a file.', true);
                return;
            }
            try {
                const buf = await input.files[0].arrayBuffer();
                const result = await api('POST', '/problems/packages', buf, 'application/gzip');
                showMsg('msg', `Accepted: ${result.count} problem(s) added. IDs: ${result.added_problem_ids.join(', ') || 'none'}`, false);
            } catch (e) {
                showMsg('msg', 'Error: ' + (e.error || e.message || 'upload failed'), true);
            }
        }

        async function submitGit() {
            const url = document.getElementById('gitUrl').value.trim();
            if (!url) {
                showMsg('msg', 'Please enter a git URL.', true);
                return;
            }
            try {
                const result = await api('POST', '/problems/packages', { git_url: url });
                showMsg('msg', `Accepted: ${result.count} problem(s) added. IDs: ${result.added_problem_ids.join(', ') || 'none'}`, false);
            } catch (e) {
                showMsg('msg', 'Error: ' + (e.error || e.message || 'submission failed'), true);
            }
        }
    </script>
</body>
</html>
