<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Conjecture â€” proof-at-home</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/shared.css">
</head>
<body>
    <nav id="navbar"></nav>
    <div class="container">
        <h1>Submit Conjecture</h1>
        <div id="msg" class="msg" style="display:none"></div>

        <div id="form-content">
            <div class="tab-bar">
                <button class="active" onclick="switchTab('upload')">Upload tar.gz</button>
                <button onclick="switchTab('git')">Git URL</button>
            </div>

            <div id="tab-upload" class="tab-panel active">
                <div class="form-group">
                    <label for="file">Conjecture package (.tar.gz)</label>
                    <input type="file" id="file" accept=".tar.gz,.tgz">
                </div>
                <button onclick="submitFile()">Upload</button>
            </div>

            <div id="tab-git" class="tab-panel">
                <div class="form-group">
                    <label for="gitUrl">Git repository URL</label>
                    <input type="text" id="gitUrl" placeholder="https://github.com/user/conjectures.git">
                </div>
                <button onclick="submitGit()">Submit</button>
            </div>
        </div>
    </div>
    <script src="/shared.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loginGate('form-content');
        });

        function switchTab(name) {
            document.querySelectorAll('.tab-bar button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.getElementById('tab-' + name).classList.add('active');
            event.target.classList.add('active');
            hideMsg('msg');
        }

        async function submitFile() {
            const input = document.getElementById('file');
            if (!input.files.length) {
                showMsg('msg', 'Please select a file.', true);
                return;
            }
            try {
                const buf = await input.files[0].arrayBuffer();
                const result = await api('POST', '/conjectures/packages', buf, 'application/gzip');
                showMsg('msg', `Accepted: ${result.count} conjecture(s) added. IDs: ${result.added_conjecture_ids.join(', ') || 'none'}`, false);
            } catch (e) {
                showMsg('msg', 'Error: ' + (e.error || e.message || 'upload failed'), true);
            }
        }

        async function submitGit() {
            const url = document.getElementById('gitUrl').value.trim();
            if (!url) {
                showMsg('msg', 'Please enter a git URL.', true);
                return;
            }
            try {
                const result = await api('POST', '/conjectures/packages', { git_url: url });
                showMsg('msg', `Accepted: ${result.count} conjecture(s) added. IDs: ${result.added_conjecture_ids.join(', ') || 'none'}`, false);
            } catch (e) {
                showMsg('msg', 'Error: ' + (e.error || e.message || 'submission failed'), true);
            }
        }
    </script>
</body>
</html>
